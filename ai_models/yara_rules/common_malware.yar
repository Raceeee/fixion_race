
rule Suspicious_PE_Characteristics
{
    meta:
        description = "Detects suspicious PE file characteristics"
        author = "Fixion"
        date = "2025-01-01"
        category = "suspicious"

    condition:
        uint16(0) == 0x5A4D and
        (
            pe.number_of_sections > 10 or
            pe.number_of_sections < 2 or
            pe.entry_point < 0x1000 or
            pe.entry_point > 0x10000000
        )
}

rule High_Entropy_Executable
{
    meta:
        description = "Detects high entropy executable files (possible packing)"
        author = "Fixion"
        category = "packer"

    condition:
        uint16(0) == 0x5A4D and
        math.entropy(0, filesize) >= 7.0
}

rule Suspicious_Imports
{
    meta:
        description = "Detects suspicious API imports"
        author = "Fixion"
        category = "suspicious"

    strings:
        $api1 = "CreateRemoteThread"
        $api2 = "WriteProcessMemory"
        $api3 = "VirtualAllocEx"
        $api4 = "SetWindowsHookEx"
        $api5 = "GetProcAddress"
        $api6 = "LoadLibrary"

    condition:
        uint16(0) == 0x5A4D and 3 of ($api*)
}

rule Ransomware_Keywords
{
    meta:
        description = "Detects ransomware-related keywords"
        author = "Fixion"
        category = "ransomware"

    strings:
        $s1 = "encrypted" nocase
        $s2 = "decrypt" nocase
        $s3 = "ransom" nocase
        $s4 = "bitcoin" nocase
        $s5 = "payment" nocase
        $s6 = "restore" nocase
        $s7 = "locked" nocase

    condition:
        3 of ($s*)
}

rule Keylogger_Indicators
{
    meta:
        description = "Detects keylogger indicators"
        author = "Fixion"
        category = "keylogger"

    strings:
        $api1 = "GetAsyncKeyState"
        $api2 = "SetWindowsHookEx"
        $api3 = "CallNextHookEx"
        $api4 = "GetKeyState"
        $s1 = "keylog" nocase
        $s2 = "keystroke" nocase

    condition:
        uint16(0) == 0x5A4D and (2 of ($api*) or any of ($s*))
}
